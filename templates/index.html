<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>EPMS Admin</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="/static/style.css">
</head>

<body>

<nav class="navbar navbar-dark" style="background:#2f5566">
    <div class="container-fluid">
        <a class="navbar-brand">Employee Payroll Management System</a>
        <div class="d-flex">
            <a class="btn btn-outline-light btn-sm me-2" href="/export/employees">Export Employees</a>
            <a class="btn btn-outline-light btn-sm" href="/logout">Logout</a>
        </div>
    </div>
</nav>

<div class="container my-4">
<div class="row">

<!-- LEFT SIDE -->
<div class="col-lg-7">

<!-- Employee Form -->
<div class="card mb-3">
<div class="card-header">Employee Details</div>
<div class="card-body">
<form id="empForm" enctype="multipart/form-data" method="post" action="/employee/add">

<div class="row g-2">
<div class="col-md-5">
<label>Employee Code</label>
<input name="emp_code" id="emp_code" class="form-control" required>
</div>
<div class="col-md-3 align-self-end">
<button id="search" type="button" class="btn btn-info">Search</button>
</div>
<div class="col-md-4">
<label>Department</label>
<select name="department_id" class="form-select">
{% for d in departments %}
<option value='{{d.id}}'>{{d.name}}</option>
{% endfor %}
</select>
</div>
</div>

<div class="row g-2 mt-2">
<div class="col-md-6"><label>First Name</label><input name="first_name" class="form-control"></div>
<div class="col-md-6"><label>Last Name</label><input name="last_name" class="form-control"></div>
</div>

<div class="row g-2 mt-2">
<div class="col-md-6">
<label>Role</label>
<select name="role_id" class="form-select">
<option value="">--</option>
{% for r in roles %}
<option value='{{r.id}}'>{{r.name}}</option>
{% endfor %}
</select>
</div>
<div class="col-md-6"><label>Contact</label><input name="contact" class="form-control"></div>
</div>

<div class="row g-2 mt-2">
<div class="col-md-6"><label>Email</label><input name="email" class="form-control"></div>
<div class="col-md-6"><label>Basic Salary</label><input name="basic_salary" class="form-control"></div>
</div>

<div class="row mt-2">
<div class="col-12">
<button class="btn btn-success">Save Employee</button>
</div>
</div>

</form>
</div>
</div>

<!-- Employee List -->
<div class="card shadow-sm">
<div class="card-header">Employees</div>
<div class="card-body p-0">
<table class="table table-striped mb-0">
<thead class="table-light">
<tr>
<th>Employee ID</th>
<th>First Name</th>
<th>Last Name</th>
<th>Department</th>
<th>Action</th>
</tr>
</thead>
<tbody>
{% for e in employees %}
<tr>
<td>{{ e.emp_code }}</td>
<td>{{ e.first_name }}</td>
<td>{{ e.last_name }}</td>
<td>{{ e.department.name if e.department else '' }}</td>
<td>
<button class='btn btn-sm btn-danger emp-delete' data-id='{{e.id}}'>Delete</button>
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>

<!-- ðŸ”¥ Leave Requests Section -->
<div class="card shadow-sm mt-3">
<div class="card-header bg-warning text-dark">
Employee Leave Requests
</div>
<div class="card-body p-0">
<table class="table table-striped mb-0">
<thead class="table-light">
<tr>
<th>ID</th>
<th>Employee</th>
<th>From</th>
<th>To</th>
<th>Reason</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>
<tbody>
{% for leave in leaves %}
<tr>
<td>{{ leave.id }}</td>
<td>{{ leave.employee.emp_code }} - {{ leave.employee.first_name }}</td>
<td>{{ leave.start_date }}</td>
<td>{{ leave.end_date }}</td>
<td>{{ leave.reason }}</td>
<td>
{% if leave.status == 'pending' %}
<span class="badge bg-warning">Pending</span>
{% elif leave.status == 'approved' %}
<span class="badge bg-success">Approved</span>
{% else %}
<span class="badge bg-danger">Rejected</span>
{% endif %}
</td>
<td>
{% if leave.status == 'pending' %}
<form method="POST" action="/leave/{{ leave.id }}/decide">
<button name="action" value="approved" class="btn btn-sm btn-success">Approve</button>
<button name="action" value="rejected" class="btn btn-sm btn-danger">Reject</button>
</form>
{% else %}
-
{% endif %}
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>

</div>

<!-- RIGHT SIDE -->
<div class="col-lg-5">

<div class="card mb-3">
<div class="card-header">Employee Salary Details</div>
<div class="card-body">

<form method="post" action="/payroll/create">
<input type="hidden" name="emp_code" id="pay_emp_code">

<div class="row g-2">
<div class="col-md-5"><label>Month</label><input name="month" class="form-control"></div>
<div class="col-md-3"><label>Year</label><input name="year" class="form-control"></div>
<div class="col-md-4"><label>Net Salary</label><input name="net_salary" class="form-control"></div>
</div>

<div class="mt-3">
<button class="btn btn-success">Save Payroll</button>
</div>

</form>

</div>
</div>

</div>
</div>

<hr>

<h5>Payroll Records</h5>
<table class="table table-bordered">
<thead class="table-light">
<tr>
<th>ID</th>
<th>Employee</th>
<th>Month</th>
<th>Year</th>
<th>Net</th>
<th>Action</th>
</tr>
</thead>
<tbody>
{% for p in payrolls %}
<tr>
<td>{{p.id}}</td>
<td>{{p.employee.emp_code}} - {{p.employee.first_name}}</td>
<td>{{p.month}}</td>
<td>{{p.year}}</td>
<td>{{'%.2f'|format(p.net_salary)}}</td>
<td><a class="btn btn-sm btn-outline-primary" href="/payroll/{{p.id}}/pdf">PDF</a></td>
</tr>
{% endfor %}
</tbody>
</table>

</div>

<script src="/static/main.js"></script>
</body>
</html>
