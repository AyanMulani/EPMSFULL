<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>EPMS Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">

<style>
body{
    background:#f4f6f9;
}

.navbar{
    background:linear-gradient(90deg,#2f5566,#1f3b4a);
}

.card{
    border:none;
    border-radius:12px;
    box-shadow:0 5px 20px rgba(0,0,0,0.05);
}

.card-header{
    font-weight:600;
    background:#ffffff;
}

.table thead{
    background:#f8f9fa;
}

.btn-success{
    background:#22c55e;
    border:none;
}

.btn-success:hover{
    background:#16a34a;
}

.badge{
    padding:6px 10px;
}
</style>
</head>

<body>

<nav class="navbar navbar-dark px-4">
  <span class="navbar-brand fw-bold">
    <i class="fa fa-building me-2"></i> EPMS Admin Panel
  </span>

  <div>
    <a class="btn btn-outline-light btn-sm me-2" href="/export/employees">
      <i class="fa fa-file-export me-1"></i> Export Employees
    </a>
    <a class="btn btn-outline-light btn-sm" href="/logout">
      <i class="fa fa-right-from-bracket me-1"></i> Logout
    </a>
  </div>
</nav>

<div class="container py-4">

<div class="row g-4">

<!-- LEFT COLUMN -->
<div class="col-lg-7">

<!-- Employee Form -->
<div class="card">
<div class="card-header">
  <i class="fa fa-user-plus me-2"></i> Employee Details
</div>
<div class="card-body">

<form method="post" action="/employee/add" enctype="multipart/form-data">

<div class="row g-3">

<div class="col-md-4">
<label>Employee Code</label>
<input name="emp_code" class="form-control" required>
</div>

<div class="col-md-4">
<label>Department</label>
<select name="department_id" class="form-select">
{% for d in departments %}
<option value="{{d.id}}">{{d.name}}</option>
{% endfor %}
</select>
</div>

<div class="col-md-4">
<label>Role</label>
<select name="role_id" class="form-select">
<option value="">--</option>
{% for r in roles %}
<option value="{{r.id}}">{{r.name}}</option>
{% endfor %}
</select>
</div>

<div class="col-md-6">
<label>First Name</label>
<input name="first_name" class="form-control">
</div>

<div class="col-md-6">
<label>Last Name</label>
<input name="last_name" class="form-control">
</div>

<div class="col-md-6">
<label>Email</label>
<input name="email" class="form-control">
</div>

<div class="col-md-6">
<label>Contact</label>
<input name="contact" class="form-control">
</div>

<div class="col-md-12">
<label>Address</label>
<textarea name="address" class="form-control"></textarea>
</div>

<div class="col-md-4">
<label>Basic Salary</label>
<input name="basic_salary" class="form-control">
</div>

</div>

<div class="mt-4">
<button class="btn btn-success">
<i class="fa fa-save me-1"></i> Save Employee
</button>
</div>

</form>

</div>
</div>


<!-- Employees Table -->
<div class="card mt-4">
<div class="card-header">
  <i class="fa fa-users me-2"></i> Employees
</div>
<div class="card-body p-0">

<table class="table table-hover mb-0">
<thead>
<tr>
<th>Code</th>
<th>Name</th>
<th>Department</th>
<th>Action</th>
</tr>
</thead>
<tbody>
{% for e in employees %}
<tr>
<td>{{e.emp_code}}</td>
<td>{{e.first_name}} {{e.last_name}}</td>
<td>{{e.department.name if e.department else ''}}</td>
<td>
<form method="POST" action="/employee/{{e.id}}/delete">
<button class="btn btn-sm btn-danger">
<i class="fa fa-trash"></i>
</button>
</form>
</td>
</tr>
{% endfor %}
</tbody>
</table>

</div>
</div>

</div>


<!-- RIGHT COLUMN -->
<div class="col-lg-5">

<!-- Payroll Form -->
<div class="card">
<div class="card-header">
  <i class="fa fa-money-bill-wave me-2"></i> Generate Payroll
</div>
<div class="card-body">

<form method="post" action="/payroll/create">

<div class="row g-3">

<div class="col-md-4">
<label>Month</label>
<input name="month" class="form-control">
</div>

<div class="col-md-4">
<label>Year</label>
<input name="year" class="form-control">
</div>

<div class="col-md-4">
<label>Net Salary</label>
<input name="net_salary" class="form-control">
</div>

</div>

<div class="mt-3">
<button class="btn btn-success w-100">
<i class="fa fa-file-invoice-dollar me-1"></i> Save Payroll
</button>
</div>

</form>

</div>
</div>


<!-- Leave Requests -->
<div class="card mt-4">
<div class="card-header">
  <i class="fa fa-calendar-check me-2"></i> Leave Requests
</div>
<div class="card-body p-0">

<table class="table table-striped mb-0">
<thead>
<tr>
<th>Employee</th>
<th>From</th>
<th>To</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>
<tbody>

{% for leave in leave_requests %}
<tr>
<td>{{leave.employee.emp_code}}</td>
<td>{{leave.start_date}}</td>
<td>{{leave.end_date}}</td>

<td>
{% if leave.status == 'pending' %}
<span class="badge bg-warning text-dark">Pending</span>
{% elif leave.status == 'approved' %}
<span class="badge bg-success">Approved</span>
{% else %}
<span class="badge bg-danger">Rejected</span>
{% endif %}
</td>

<td>
{% if leave.status == 'pending' %}
<form method="POST" action="/leave/{{leave.id}}/decide" style="display:inline;">
<input type="hidden" name="action" value="approved">
<button class="btn btn-sm btn-success">Approve</button>
</form>

<form method="POST" action="/leave/{{leave.id}}/decide" style="display:inline;">
<input type="hidden" name="action" value="rejected">
<button class="btn btn-sm btn-danger">Reject</button>
</form>
{% else %}
-
{% endif %}
</td>

</tr>
{% endfor %}

</tbody>
</table>

</div>
</div>

</div>

</div>


<!-- Payroll Records -->
<div class="card mt-5">
<div class="card-header">
  <i class="fa fa-receipt me-2"></i> Payroll Records
</div>
<div class="card-body p-0">

<table class="table table-bordered mb-0">
<thead>
<tr>
<th>ID</th>
<th>Employee</th>
<th>Month</th>
<th>Year</th>
<th>Net</th>
<th>PDF</th>
</tr>
</thead>
<tbody>
{% for p in payrolls %}
<tr>
<td>{{p.id}}</td>
<td>{{p.employee.emp_code}}</td>
<td>{{p.month}}</td>
<td>{{p.year}}</td>
<td>{{p.net_salary}}</td>
<td>
<a class="btn btn-sm btn-outline-primary" href="/payroll/{{p.id}}/pdf">
<i class="fa fa-file-pdf"></i>
</a>
</td>
</tr>
{% endfor %}
</tbody>
</table>

</div>
</div>

</div>

</body>
</html>
